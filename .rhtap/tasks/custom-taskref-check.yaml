apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: custom-taskref-check
spec:
  description: This is a custom taskref check implementation.
  params:
    - description: An message to print.
      name: MESSAGE
      type: string
  results:
    - description: Tekton task test output.
      name: TEST_OUTPUT
  steps:
    - env:
        - name: MESSAGE
          value: $(params.MESSAGE)
      image: ubuntu:latest
      name: custom-taskref-check
      script: |
        #!/usr/bin/env bash
        TEST_OUTPUT="{\"output\": \"${MESSAGE}\"}"
        echo "${TEST_OUTPUT}" | tee $(results.TEST_OUTPUT.path)
      securityContext:
        capabilities:
          add:
            - SETFCAP
        runAsUser: 0
      volumeMounts:
        - mountPath: /shared
          name: shared
  volumes:
    - emptyDir: {}
      name: shared
