apiVersion: v1
kind: Secret

metadata:
  name: infra-server-secrets
  namespace: infra
  labels:
    app.kubernetes.io/name: infra-server

data:
  # Service account used for generating GCS signed URLs.
  google-credentials.json: |-
    {{ required ".Values.google_credentials_json is undefined" .Values.google_credentials_json }}

  # Service account used for logging cluster creation and deletion to BigQuery
  bigquery-sa.json: |-
    {{ required ".Values.bigquery_sa_json is undefined" .Values.bigquery_sa_json }}

  oidc.yaml: |-
    {{- tpl (required ".Values.oidc_yaml | b64dec) . | b64enc | nindent 4 is undefined" .Values.oidc_yaml | b64dec) . | b64enc | nindent 4 }}

  cert.pem: |-
    {{ required ".Values.tls__cert_pem is undefined" .Values.tls__cert_pem | nindent 4 }}

  key.pem: |-
    {{ required ".Values.tls__key_pem is undefined" .Values.tls__key_pem | nindent 4 }}

  infra.yaml: |-
    {{ required ".Values.infra_yaml is undefined" .Values.infra_yaml }}

  flavors.yaml: |-
    {{- tpl (.Files.Get "static/flavors.yaml") . | b64enc | nindent 4 }}

  workflow-gke-default.yaml: |-
    {{- .Files.Get "static/workflow-gke-default.yaml" | b64enc | nindent 4 }}

  workflow-demo.yaml: |-
    {{- .Files.Get "static/workflow-demo.yaml" | b64enc | nindent 4 }}

  workflow-qa-demo.yaml: |-
    {{- .Files.Get "static/workflow-qa-demo.yaml" | b64enc | nindent 4 }}

  workflow-openshift-multi.yaml: |-
    {{- .Files.Get "static/workflow-openshift-multi.yaml" | b64enc | nindent 4 }}

  workflow-openshift-4.yaml: |-
    {{- .Files.Get "static/workflow-openshift-4.yaml" | b64enc | nindent 4 }}

  workflow-openshift-4-demo.yaml: |-
    {{- .Files.Get "static/workflow-openshift-4-demo.yaml" | b64enc | nindent 4 }}

  workflow-openshift-4-perf-scale.yaml: |-
    {{- .Files.Get "static/workflow-openshift-4-perf-scale.yaml" | b64enc | nindent 4 }}

  workflow-eks.yaml: |-
    {{- .Files.Get "static/workflow-eks.yaml" | b64enc | nindent 4 }}

  workflow-aks.yaml: |-
    {{- .Files.Get "static/workflow-aks.yaml" | b64enc | nindent 4 }}

  workflow-openshift-aro.yaml: |-
    {{- .Files.Get "static/workflow-openshift-aro.yaml" | b64enc | nindent 4 }}

  workflow-openshift-rosa.yaml: |-
    {{- .Files.Get "static/workflow-openshift-rosa.yaml" | b64enc | nindent 4 }}

  workflow-openshift-rosa-hcp.yaml: |-
    {{- .Files.Get "static/workflow-openshift-rosa-hcp.yaml" | b64enc | nindent 4 }}

  workflow-openshift-ibmroks.yaml: |-
    {{- .Files.Get "static/workflow-openshift-ibmroks.yaml" | b64enc | nindent 4 }}

  workflow-osd-aws.yaml: |-
    {{- .Files.Get "static/workflow-osd-aws.yaml" | b64enc | nindent 4 }}

  workflow-osd-gcp.yaml: |-
    {{- .Files.Get "static/workflow-osd-gcp.yaml" | b64enc | nindent 4 }}

{{ if ne .Values.environment "production" }}

  test-url-artifact.yaml: |-
    {{- .Files.Get "static/test-url-artifact.yaml" | b64enc | nindent 4 }}

  test-connect-artifact.yaml: |-
    {{- .Files.Get "static/test-connect-artifact.yaml" | b64enc | nindent 4 }}

{{ end }}

{{ if eq .Values.environment "development" }}
---

apiVersion: v1
kind: Secret
type: kubernetes.io/dockerconfigjson

metadata:
  name: infra-image-registry-pull-secret
  namespace: infra

data:
  .dockerconfigjson: {{ .Values.pullSecrets.stackroxInfraGCR }}

{{ end }}
